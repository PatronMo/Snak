<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Snake Game</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
  body {
    margin: 0;
    background: #0f0f0f;
    color: white;
    font-family: Arial, sans-serif;
    text-align: center;
  }

  canvas {
    background: #000;
    border: 3px solid #00ff66;
    margin-top: 5px;
  }

  .hidden { display: none; }

  .score {
    font-size: 18px;
    margin: 4px 0;
  }

  .best {
    color: gold;
    transition: transform 0.2s;
  }

  .best.flash {
    animation: bestFlash 0.4s ease;
  }

  @keyframes bestFlash {
    0%   { transform: scale(1); color: gold; }
    50%  { transform: scale(1.3); color: #fff176; }
    100% { transform: scale(1); color: gold; }
  }

  .score-pop {
    position: absolute;
    color: #00ff66;
    font-weight: bold;
    pointer-events: none;
    animation: pop 0.6s ease-out forwards;
  }

  @keyframes pop {
    0%   { opacity: 1; transform: translateY(0) scale(1); }
    100% { opacity: 0; transform: translateY(-25px) scale(1.4); }
  }
</style>
</head>

<body>

<h1>üêç Snake</h1>

<div id="usernameScreen">
  <p>Choose a username (cannot be changed)</p>
  <input id="usernameInput" maxlength="12" placeholder="Username">
  <br>
  <button onclick="saveUsername()">Start</button>
</div>

<div id="gameScreen" class="hidden">
  <p>Player: <strong id="playerName"></strong></p>

  <p class="score">
    Score: <strong id="scoreDisplay">0</strong> |
    Best: <strong id="bestDisplay" class="best">0</strong>
  </p>

  <div style="position:relative; display:inline-block;">
    <canvas id="game" width="400" height="400"></canvas>
  </div>

  <p id="deathText" class="hidden">üíÄ You died ‚Äî press <b>SPACE</b> to respawn</p>

  <h3>üèÜ Leaderboard</h3>
  <ol id="leaderboard"></ol>
</div>

<script>
/* ---------- STORAGE ---------- */
const USER_KEY = "snake_username";
const SCORE_KEY = "snake_scores";

let username = localStorage.getItem(USER_KEY);
let scores = JSON.parse(localStorage.getItem(SCORE_KEY)) || {};

/* ---------- CANVAS ---------- */
const canvas = document.getElementById("game");
const ctx = canvas.getContext("2d");
const box = 20;

/* ---------- GAME STATE ---------- */
let snake, food, score;
let direction = "RIGHT";
let nextDirection = "RIGHT";
let loop = null;
let alive = true;

/* ---------- USERNAME ---------- */
function saveUsername() {
  const input = document.getElementById("usernameInput").value.trim();
  if (!input) return alert("Enter a username");
  if (scores[input]) return alert("Username already exists");

  localStorage.setItem(USER_KEY, input);
  username = input;
  startGame();
}

/* ---------- START ---------- */
function startGame() {
  document.getElementById("usernameScreen").classList.add("hidden");
  document.getElementById("gameScreen").classList.remove("hidden");
  document.getElementById("playerName").textContent = username;

  document.getElementById("bestDisplay").textContent = scores[username] || 0;
  resetGame();
}

/* ---------- RESET / RESPAWN ---------- */
function resetGame() {
  snake = [
    { x: 10 * box, y: 10 * box },
    { x: 9 * box,  y: 10 * box },
    { x: 8 * box,  y: 10 * box }
  ];

  direction = "RIGHT";
  nextDirection = "RIGHT";
  score = 0;
  alive = true;
  food = spawnFood();

  document.getElementById("scoreDisplay").textContent = 0;
  document.getElementById("deathText").classList.add("hidden");

  clearInterval(loop);
  loop = setInterval(draw, 70); // smooth
  updateLeaderboard();
}

/* ---------- FOOD ---------- */
function spawnFood() {
  return {
    x: Math.floor(Math.random() * 20) * box,
    y: Math.floor(Math.random() * 20) * box
  };
}

/* ---------- INPUT ---------- */
document.addEventListener("keydown", e => {
  if (!alive && e.code === "Space") resetGame();

  if (e.key === "ArrowLeft"  && direction !== "RIGHT") nextDirection = "LEFT";
  if (e.key === "ArrowUp"    && direction !== "DOWN")  nextDirection = "UP";
  if (e.key === "ArrowRight" && direction !== "LEFT")  nextDirection = "RIGHT";
  if (e.key === "ArrowDown"  && direction !== "UP")    nextDirection = "DOWN";
});

/* ---------- DRAW ---------- */
function draw() {
  direction = nextDirection;

  ctx.fillStyle = "black";
  ctx.fillRect(0, 0, canvas.width, canvas.height);

  snake.forEach((s, i) => {
    ctx.fillStyle = i === 0 ? "#00ff66" : "#00cc55";
    ctx.fillRect(s.x, s.y, box, box);
  });

  ctx.fillStyle = "red";
  ctx.fillRect(food.x, food.y, box, box);

  let head = { ...snake[0] };

  if (direction === "LEFT") head.x -= box;
  if (direction === "RIGHT") head.x += box;
  if (direction === "UP") head.y -= box;
  if (direction === "DOWN") head.y += box;

  if (
    head.x < 0 || head.y < 0 ||
    head.x >= canvas.width || head.y >= canvas.height ||
    snake.some(s => s.x === head.x && s.y === head.y)
  ) {
    return gameOver();
  }

  if (head.x === food.x && head.y === food.y) {
    score++;
    document.getElementById("scoreDisplay").textContent = score;
    scorePop(head.x, head.y);

    if (score > (scores[username] || 0)) {
      document.getElementById("bestDisplay").textContent = score;
      document.getElementById("bestDisplay").classList.add("flash");
      setTimeout(() =>
        document.getElementById("bestDisplay").classList.remove("flash"), 300);
    }

    food = spawnFood();
  } else {
    snake.pop();
  }

  snake.unshift(head);
}

/* ---------- SCORE POP ---------- */
function scorePop(x, y) {
  const pop = document.createElement("div");
  pop.className = "score-pop";
  pop.textContent = "+1";
  pop.style.left = canvas.offsetLeft + x + "px";
  pop.style.top  = canvas.offsetTop  + y + "px";
  document.body.appendChild(pop);
  setTimeout(() => pop.remove(), 600);
}

/* ---------- GAME OVER ---------- */
function gameOver() {
  alive = false;
  clearInterval(loop);

  if (!scores[username] || score > scores[username]) {
    scores[username] = score;
    localStorage.setItem(SCORE_KEY, JSON.stringify(scores));
  }

  document.getElementById("deathText").classList.remove("hidden");
  updateLeaderboard();
}

/* ---------- LEADERBOARD ---------- */
function updateLeaderboard() {
  const board = document.getElementById("leaderboard");
  board.innerHTML = "";

  Object.entries(scores)
    .sort((a, b) => b[1] - a[1])
    .slice(0, 10)
    .forEach(([name, sc]) => {
      const li = document.createElement("li");
      li.textContent = `${name}: ${sc}`;
      board.appendChild(li);
    });
}

/* ---------- AUTO START ---------- */
if (username) startGame();
</script>

</body>
</html>
