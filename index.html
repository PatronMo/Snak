<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Snake Game</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
  body {
    margin: 0;
    background: #0f0f0f;
    color: white;
    font-family: Arial, sans-serif;
    text-align: center;
  }

  h1 {
    margin-top: 10px;
  }

  canvas {
    background: #000;
    border: 3px solid #00ff66;
    margin-top: 10px;
  }

  input, button {
    padding: 10px;
    font-size: 16px;
    margin-top: 5px;
  }

  button {
    cursor: pointer;
  }

  .hidden {
    display: none;
  }

  ol {
    padding-left: 0;
    list-style-position: inside;
  }
</style>
</head>

<body>

<h1>üêç Snake</h1>

<div id="usernameScreen">
  <p>Choose a username (cannot be changed)</p>
  <input id="usernameInput" maxlength="12" placeholder="Username">
  <br>
  <button onclick="saveUsername()">Start Game</button>
</div>

<div id="gameScreen" class="hidden">
  <p>Player: <strong id="playerName"></strong></p>
  <canvas id="game" width="400" height="400"></canvas>

  <h3>üèÜ Leaderboard</h3>
  <ol id="leaderboard"></ol>
</div>

<script>
/* -------------------- STORAGE -------------------- */
const USER_KEY = "snake_username";
const SCORE_KEY = "snake_scores";

let username = localStorage.getItem(USER_KEY);
let scores = JSON.parse(localStorage.getItem(SCORE_KEY)) || {};

/* -------------------- GAME VARS -------------------- */
const canvas = document.getElementById("game");
const ctx = canvas.getContext("2d");

const box = 20;
let snake = [];
let direction = "RIGHT";
let food = {};
let score = 0;
let loop;

/* -------------------- USERNAME -------------------- */
function saveUsername() {
  const input = document.getElementById("usernameInput").value.trim();

  if (!input) return alert("Enter a username");
  if (scores[input]) return alert("Username already exists");

  localStorage.setItem(USER_KEY, input);
  username = input;
  startGame();
}

/* -------------------- START -------------------- */
function startGame() {
  document.getElementById("usernameScreen").classList.add("hidden");
  document.getElementById("gameScreen").classList.remove("hidden");
  document.getElementById("playerName").textContent = username;

  snake = [{ x: 9 * box, y: 10 * box }];
  direction = "RIGHT";
  score = 0;
  food = spawnFood();

  clearInterval(loop);
  loop = setInterval(draw, 100);
  updateLeaderboard();
}

/* -------------------- FOOD -------------------- */
function spawnFood() {
  return {
    x: Math.floor(Math.random() * 20) * box,
    y: Math.floor(Math.random() * 20) * box
  };
}

/* -------------------- CONTROLS -------------------- */
document.addEventListener("keydown", e => {
  if (e.key === "ArrowLeft" && direction !== "RIGHT") direction = "LEFT";
  if (e.key === "ArrowUp" && direction !== "DOWN") direction = "UP";
  if (e.key === "ArrowRight" && direction !== "LEFT") direction = "RIGHT";
  if (e.key === "ArrowDown" && direction !== "UP") direction = "DOWN";
});

/* -------------------- DRAW -------------------- */
function draw() {
  ctx.fillStyle = "black";
  ctx.fillRect(0, 0, canvas.width, canvas.height);

  snake.forEach((part, i) => {
    ctx.fillStyle = i === 0 ? "#00ff66" : "#00cc55";
    ctx.fillRect(part.x, part.y, box, box);
  });

  ctx.fillStyle = "red";
  ctx.fillRect(food.x, food.y, box, box);

  let head = { ...snake[0] };

  if (direction === "LEFT") head.x -= box;
  if (direction === "RIGHT") head.x += box;
  if (direction === "UP") head.y -= box;
  if (direction === "DOWN") head.y += box;

  if (
    head.x < 0 || head.y < 0 ||
    head.x >= canvas.width || head.y >= canvas.height ||
    snake.some(p => p.x === head.x && p.y === head.y)
  ) {
    return gameOver();
  }

  if (head.x === food.x && head.y === food.y) {
    score++;
    food = spawnFood();
  } else {
    snake.pop();
  }

  snake.unshift(head);
}

/* -------------------- GAME OVER -------------------- */
function gameOver() {
  clearInterval(loop);

  // üîë THIS PREVENTS DUPLICATES
  if (!scores[username] || score > scores[username]) {
    scores[username] = score;
    localStorage.setItem(SCORE_KEY, JSON.stringify(scores));
  }

  alert("Game Over! Score: " + score);
  updateLeaderboard();
}

/* -------------------- LEADERBOARD -------------------- */
function updateLeaderboard() {
  const board = document.getElementById("leaderboard");
  board.innerHTML = "";

  Object.entries(scores)
    .sort((a, b) => b[1] - a[1])
    .slice(0, 10)
    .forEach(([name, score]) => {
      const li = document.createElement("li");
      li.textContent = `${name}: ${score}`;
      board.appendChild(li);
    });
}

/* -------------------- AUTO START -------------------- */
if (username) {
  startGame();
}
</script>

</body>
</html>
